# docker-education-repo

## Содержание:
1. [Введение в Docker](#Introduction)

2. [Контейнер как экземпляр класса](#Container-as-an-instance-of-a-class)

3. [Концепции Docker](#Docker-Concepts)

4. [Термины](#terms)

5. [Образы Docker (Docker images)](#docker-images)

6. [DockerFile](#dockerfile)

7. [Docker Compose](#docker-composee)

8. [Сборка и запуск проекта с помощью docker-compose](#build-n-run)
   


## Введение в Docker <a name="Introduction"></a>  
Docker представляет собой инструмент для разработки, развертывания и запуска приложений в контейнерах, что облегчает процессы развертывания и масштабирования приложений. Docker-контейнеры можно сравнить с обычными пластиковыми контейнерами для хранения и перемещения вещей, которые можно легко создавать, управлять и взаимодействовать с ними. Образы Docker можно рассматривать как шаблоны, а контейнеры - как экземпляры, содержащие конкретные приложения. Давайте более подробно изучим эту тему.


Технологии контейнеризации приложений стали популярными в сфере разработки ПО, упрощая развертывание, управление и масштабирование приложений. Docker стал своеобразным синонимом контейнеризации, и при изучении разработки приложений это понятие становится неотъемлемой частью.

Если вы углубитесь в разработку приложений, вы обязательно столкнетесь с Docker. Давайте начнем изучение Docker и разберем, почему он так удобен для использования.

### Пример аналогии для понимания Docker в повседневной жизни
Для легкости восприятия новых технологий полезно использовать аналогии. Например, виртуальные контейнеры можно сравнить с обычными пластиковыми контейнерами для хранения вещей. Давайте начнем обсуждение Docker с понятия контейнера.

### Контейнер
Контейнер Docker имеет схожие характеристики с обычным пластиковым контейнером:

* Контейнер можно приобрести, если он отсутствует.
* Контейнеры Docker создаются на основе образов, которые можно сравнить с формой контейнера, хранящейся в специальном репозитории. При необходимости контейнера можно загрузить из репозитория и создать его на основе образа.
* Контейнер может содержать что-то внутри, а также взаимодействовать с внешним миром. Контейнеры Docker имеют средства взаимодействия, такие как сетевые порты, которые можно открывать для доступа к приложениям, работающим внутри контейнера. Также с контейнером можно взаимодействовать через командную строку.
* Контейнер Docker можно перемещать и использовать на разных машинах, что схоже с тем, как обычные контейнеры можно переносить без изменения содержимого.
Однако стоит отметить, что в отличие от обычных пластиковых контейнеров, Docker-контейнеры всегда содержат что-то полезное.

## Контейнер как экземпляр класса <a name="Container-as-an-instance-of-a-class"></a> 
При создании программ с использованием объектно-ориентированных языков программирования, таких как C#, мы описываем объекты в виде классов. Класс содержит свойства и методы для работы с объектами, и создание экземпляра класса оживляет объект, придавая ему конкретные характеристики.

Точно так же в мире Docker существует понятие образа, который можно рассматривать как класс, описывающий модель программы. Из этого образа создаются контейнеры, которые уже содержат конкретное приложение и могут выполнять определенную работу.

## Концепции Docker <a name="Docker-Concepts"></a> 
Виртуальные машины служат предшественниками Docker-контейнеров и также изолируют приложения и их зависимости от внешнего окружения. Однако Docker-контейнеры имеют ряд преимуществ:

* Они требуют меньше ресурсов, так как образ содержит только необходимое окружение.
* Легко перемещаются через репозитории.
* Запускаются быстрее благодаря минималистичному окружению и отсутствию лишних зависимостей.
* Их управление упрощается с использованием специальных инструментов.
  
### Образ контейнера Docker
Понятие "образ" в Docker относится к неизменяемым шаблонам, используемым для создания однотипных контейнеров. Образ контейнера Docker содержит базовую операционную систему, код приложения и необходимые библиотеки, все это объединено в единую сущность, на основе которой можно создать контейнер.

### Файл Dockerfile
Dockerfile содержит набор инструкций, по которым Docker собирает образ для будущих контейнеров. Он определяет базовый образ, который представляет собой стартовую точку для создания контейнера, а также содержит инструкции для добавления дополнительных компонентов приложения. Все это описывается в Dockerfile.

### Контейнер Docker
Для запуска контейнера необходимы образ контейнера и среда с установленным Docker, которая может интерпретировать команду "docker run image_name". Эта команда создает контейнер на основе образа и запускает его.

### Репозиторий контейнеров
Если вы хотите предоставить образ контейнера для использования сообществом, вы можете делиться им через облачное хранилище. Docker Hub является крупнейшим репозиторием контейнеров, который широко используется в экосистеме Docker.

Мы рассмотрели основные понятия Docker, и теперь мы готовы более подробно изучить эти термины, чтобы лучше понимать работу с Docker.

## Термины <a name="terms"></a> 
### Docker Platform
Платформа Docker (Docker Platform) представляет собой программное обеспечение, которое облегчает упаковку приложений в контейнеры и их запуск на контурах. Это позволяет включить в контейнеры как код приложения, так и все необходимые зависимости. В результате, системы, построенные на контейнерах, могут легко масштабироваться, поскольку контейнеры можно переносить и воспроизводить.

### Docker Engine
Движок Docker (Docker Engine) представляет собой клиент-серверное приложение. Docker поставляется в двух версиях: Docker Community Edition (CE) - бесплатное программное обеспечение, основанное на открытом исходном коде, и Docker Enterprise - платная версия, предоставляющая дополнительные возможности в области поддержки, управления и безопасности. Для индивидуального использования и в небольших компаниях версия CE обычно подходит, так как по функционалу она мало чем отличается от платной версии.

### Docker Daemon
Демон Docker (Docker Daemon) представляет собой сервер Docker, который обрабатывает запросы к API Docker. Он управляет образами, контейнерами, сетями и томами.

### Docker Client
Клиент Docker (Docker Client) является основным средством взаимодействия с движком Docker. Существует несколько вариантов клиентов, включая Docker Command Line Interface (CLI), который взаимодействует через командную строку (терминал), и Docker Desktop, предоставляющий графический интерфейс для управления демоном Docker. Функциональность обоих клиентов практически одинакова.

### Docker Volumes
Тома Docker (Docker Volumes) представляют собой механизм постоянного хранения данных, создаваемых приложением. Поскольку каждый контейнер создается из образа, данные могут быть утеряны при удалении контейнера. Тома предоставляют постоянное хранилище данных.

### Docker Registry
Реестр Docker (Docker Registry) - это удаленная платформа для хранения Docker-образов. При работе с Docker часто требуется загружать образы, а также возможность их отправки в реестр. Реестр можно настроить на своем собственном сервере, а также использовать сервисы, такие как Docker Hub и GitHub, для хранения образов.

### Docker Repository
Репозиторий Docker (Docker Repository) представляет собой набор Docker-образов с одинаковыми именами, но разными тегами, которые являются идентификаторами образов. Репозитории хранят различные версии образов. Например, имя репозитория Docker в DockerHub - bitnami/dotnet-sdk, а версия образа с тегом 7.0.302-debian-11-r7s. Репозиторий может содержать как целый набор образов, так и отдельные образы.

Теперь рассмотрим термины, связанные с масштабированием решений на основе Docker.

### Docker Networking
Сетевые механизмы Docker (Docker Networking) позволяют устанавливать связь между контейнерами Docker. Соединенные контейнеры могут выполняться как на одном хосте, так и на разных хостах.

### Docker Services
Сервисы Docker (Docker Services) объединяют различные части распределенного приложения. Сервисы представляют собой набор контейнеров, работающих в рамках одного сервиса, и определяют, как использовать образы, какие порты использовать и сколько экземпляров контейнера нужно создать для обеспечения необходимой производительности.

### Docker Swarm
Docker Swarm - это решение для управления контейнерными развертываниями и оркестрации контейнеров. Этот инструмент позволяет автоматизировать развертывание и масштабирование контейнеризированных приложений.

### Docker Compose
Docker Compose - это инструмент, который упрощает одновременное развертывание нескольких контейнеров приложений. Команды Docker Compose описываются в файле docker-compose.yaml и позволяют управлять группами контейнеров с помощью одной команды.

### Kubernetes
Kubernetes (k8s) - это технология, предназначенная для автоматизации развертывания и масштабирования контейнеризированных приложений и управления ими. Kubernetes часто используется в сочетании с Docker для оркестрации контейнеров.

## Образы Docker (Docker images) <a name="docker-images"></a> 
Контейнер Docker представляет собой специфичный экземпляр определенного образа. Это своеобразная автономная операционная система, содержащая только минимальный набор компонентов окружения, необходимых для правильной работы целевого приложения.

Мы уже введем понятие образа, и теперь давайте рассмотрим, как можно создать такой образ.

Для создания образа потребуются следующие компоненты: код целевого приложения, Docker Engine (установленный), и файл Dockerfile, который содержит инструкции для создания образа. После выполнения всех инструкций в Dockerfile, получается готовый образ, который можно использовать и распространять.

При вызове команды "docker build" в каталоге, содержащем Dockerfile, создается готовый образ. Если Dockerfile находится в другом каталоге, можно использовать флаг "-f" для указания пути к файлу Dockerfile.

Как упоминалось ранее, контейнеры состоят из слоев, и каждый слой, кроме верхнего, доступен только для чтения. Dockerfile содержит инструкции, которые сообщают Docker, какие слои нужно добавить в целевой образ и в каком порядке. Каждый слой фактически представляет собой файл, описывающий изменения, необходимые для перехода от предыдущего слоя к новому. При создании нового образа базируется на исходном (родительском) слое.

При скачивании образа из удаленного репозитория Docker загружает только те слои, которые отсутствуют на локальной системе. Docker оптимизирует пространство и время, поэтому если два приложения имеют одинаковый родительский образ, загружаются только отсутствующие слои. По сути, это означает, что при загрузке двух приложений с одинаковым родительским образом загружаются всего три слоя: один базовый и два слоя от самих приложений.

DockerFile <a name="dockerfile"></a>  
DockerFile - это текстовый файл, который содержит инструкции для создания Docker-образа. Этот файл служит для автоматизации процесса сборки образа и определения установки необходимого программного обеспечения и настроек в контейнере. Давайте рассмотрим, как работать с DockerFile.

Как уже упоминалось ранее, DockerFile содержит инструкции для создания образа. Каждая инструкция начинается с заглавных букв, за которыми следуют аргументы. Эти инструкции выполняются в строгой последовательности сверху вниз.

Примеры инструкций DockerFile:

* FROM - определяет базовый (родительский) образ.

* LABEL - содержит метаданные, такие как информация о создателе и поддержке образа.

* ENV - устанавливает постоянные переменные среды.

* RUN - выполняет команду и создает слой образа, часто используется для установки пакетов в контейнере.

* COPY - копирует файлы и папки в контейнер.

* ADD - копирует файлы и папки в контейнер и может распаковывать локальные .tar-файлы.

* CMD - определяет команду с аргументами, которую нужно выполнить при запуске контейнера. Аргументы могут быть переопределены при запуске контейнера.

* WORKDIR - задает рабочую директорию для следующей инструкции.

* ARG - определяет переменные, которые могут передаваться Docker во время сборки образа.

* ENTRYPOINT - предоставляет команду с аргументами для вызова во время выполнения контейнера. Аргументы не могут быть переопределены.

* EXPOSE - указывает на необходимость открытия порта в контейнере.

* VOLUME - создает точку монтирования для работы с постоянным хранилищем.

Следует отметить, что слои в итоговом образе создаются только при использовании инструкций FROM, RUN, COPY и ADD. Другие инструкции могут выполнять настройку, описывать метаданные или указывать действия, которые нужно выполнить при запуске контейнера.

### Инструкция FROM
Инструкция FROM (ИЗ) предоставляет базовый (родительский) образ, на основе которого будет создаваться новый Docker-образ. Она определяет стартовую точку для сборки образа. В сущности, она указывает, с какого образа начать наше новое контейнерное приключение.

### Инструкция LABEL
Инструкция LABEL (метка) позволяет добавлять метаданные в Docker-образ. В данном контексте, мы добавили информацию о том, какая команда подготовила этот образ. Важно отметить, что объявление меток не влияет на скорость сборки образа и не увеличивает его размер. Они служат для предоставления полезной информации о Docker-образе и поэтому рекомендуется включать их в Dockerfile. Дополнительные детали по работе с метаданными в Dockerfile могут быть найдены в данном руководстве.

### Инструкция ENV
Инструкция ENV позволяет устанавливать переменные среды внутри контейнера, которые будут доступны при его выполнении. В данном примере, мы создали переменную среды, которая содержит строку подключения к базе данных. Эту переменную можно использовать, например, как часть конфигурации в приложении на платформе DotNET.

ENV полезна для определения постоянных значений. Если значение используется несколько раз в Dockerfile, например, при выполнении различных команд, это позволяет удобно изменять это значение в одном месте, если потребуется внести изменения.

Важно отметить, что существует несколько способов выполнения однотипных задач в файлах Dockerfile. Например, инструкции RUN, CMD и ENTRYPOINT имеют разные цели, но часто используются для выполнения команд. Выбор конкретной инструкции зависит от контекста и требований конкретной ситуации.

### Инструкция RUN
Инструкция RUN позволяет создавать слои в образе в процессе его сборки. После выполнения инструкции RUN, Docker добавляет новый слой в образ и сохраняет его состояние. Эта инструкция часто используется для установки дополнительных пакетов в образе. В представленном примере, инструкция RUN dotnet restore говорит Docker выполнять команду dotnet, чтобы загрузить необходимые зависимости из источника пакетов. Далее, команда RUN dotnet publish -c Release -o out компилирует проект в режиме Release и сохраняет полученные файлы в папке "out".

Инструкция RUN, а также аналогичные ей инструкции, такие как CMD и ENTRYPOINT, могут использоваться в двух формах: exec-форме и shell-форме. В exec-форме они используют синтаксис, аналогичный описанию JSON-массива, например: RUN ["my_executable", "my_first_param1", "my_second_param2"]. В представленном Dockerfile, мы используем shell-форму инструкции RUN, например: RUN dotnet publish -c Release -o out.

Затем, в Dockerfile используется exec-форма инструкции ENTRYPOINT, как показано: ENTRYPOINT ["dotnet", "Test.Api.dll"], для непосредственного запуска приложения. При использовании этой формы, важно использовать двойные кавычки для определения строк, так как это соответствует стандарту JSON.

### Инструкция ENTRYPOINT
Инструкция ENTRYPOINT предоставляет возможность задать команду и аргументы, которые должны выполняться при запуске контейнера. Она очень похожа на инструкцию CMD, но с одним существенным отличием: параметры, заданные в ENTRYPOINT, не перезаписываются, если контейнер запускается с аргументами командной строки.

Если в Dockerfile присутствует инструкция ENTRYPOINT, и вы запускаете контейнер с дополнительными аргументами, они добавляются в конец списка аргументов, определенных в инструкции ENTRYPOINT.

Для создания Dockerfile обязательно должна присутствовать хотя бы одна из инструкций ENTRYPOINT или CMD, иначе образ не соберется.

В официальной документации Docker есть рекомендации относительно выбора между CMD и ENTRYPOINT при запуске контейнера:

Если вам всегда нужно выполнять одну и ту же команду при запуске контейнера, используйте ENTRYPOINT.

Если контейнер будет использоваться как самостоятельное приложение, тоже лучше использовать ENTRYPOINT.

Если вы знаете, что при запуске контейнера нужно будет передавать аргументы, которые могут перезаписать параметры, указанные в Dockerfile, лучше использовать CMD.

Также следует отметить, что в документации рекомендуется использовать exec-форму для инструкции ENTRYPOINT, что выглядит как ENTRYPOINT ["executable", "param1", "param2"].

### Инструкция CMD
Инструкция CMD предоставляет команду, которую Docker должен выполнить при запуске контейнера. Результаты выполнения этой команды не включаются в образ во время его сборки.

Важные аспекты, связанные с инструкцией CMD:

В Dockerfile может быть только одна инструкция CMD. Если есть несколько инструкций CMD в файле, будет использована только последняя.

Инструкция CMD может использовать exec-форму. Если команда не включает имя исполняемого файла, то в Dockerfile должна присутствовать инструкция ENTRYPOINT. В этом случае обе инструкции должны быть в формате JSON.

Аргументы командной строки, передаваемые через docker run, перезаписывают аргументы, указанные в инструкции CMD Dockerfile.

### Инструкция WORKDIR
Инструкция WORKDIR позволяет изменить рабочий каталог контейнера. В этом каталоге будут выполняться следующие инструкции, такие как COPY, ADD, RUN, CMD и ENTRYPOINT. Важные аспекты использования этой инструкции:

Рекомендуется использовать абсолютные пути к каталогам с помощью WORKDIR, а не изменять текущий каталог с помощью команды cd в Dockerfile.

Инструкция WORKDIR автоматически создает указанный каталог, если его нет.

Можно использовать несколько инструкций WORKDIR в Dockerfile. Если они используют относительные пути, каждая из них изменит текущий рабочий каталог соответственно.

В вашем примере, инструкция WORKDIR используется для создания каталога src и установки его как текущего рабочего каталога.

### Инструкция COPY
Инструкция COPY в вашем файле Dockerfile выглядит так: COPY . ./. Она указывает Docker'у скопировать файлы и каталоги из локального контекста сборки в текущий рабочий каталог образа. Если целевой каталог не существует, инструкция COPY его создаст.

В вашем примере происходит копирование всего проекта в указанный рабочий каталог. При этом рабочим каталогом будет каталог src, который был определен инструкцией WORKDIR ./src.

### Инструкция ADD
Инструкция ADD предоставляет возможность выполнить те же задачи, что и инструкция COPY. Однако инструкция ADD имеет дополнительные возможности, такие как добавление файлов из удаленных источников (например, по URL) и распаковка локальных .tar-файлов.

Важно отметить, что документация Docker рекомендует избегать использования инструкции ADD для файлов, загруженных по URL, так как они могут увеличить размер образа и не могут быть легко удалены.

В большинстве случаев рекомендуется использовать инструкцию COPY вместо инструкции ADD, чтобы сделать Dockerfile более понятным и уменьшить количество инструкций, которые нужно помнить при создании образов.

### Инструкция ARG
Инструкция ARG позволяет задать переменные, значения которых могут быть переданы в образ из командной строки во время его сборки. Значение по умолчанию для переменной можно указать в Dockerfile, например: ARG my_var=my_default_value.

В отличие от ENV-переменных, ARG-переменные не доступны во время выполнения контейнера. Однако ARG-переменные могут использоваться для установки значений по умолчанию для ENV-переменных из командной строки во время сборки образа. ENV-переменные уже будут доступны внутри контейнера во время его выполнения.

### Инструкция EXPOSE
Инструкция EXPOSE определяет, какие порты контейнера планируется открывать, чтобы внешние приложения могли взаимодействовать с работающим контейнером. Эта инструкция фактически не открывает порты; она служит скорее как документация для тех, кто будет запускать контейнеры из этого образа.

Для открытия портов и настройки перенаправления портов следует использовать ключ -p при выполнении команды docker run. Если использовать ключ -P (с заглавной буквой P), будут открыты все порты, указанные в инструкции EXPOSE.

### Инструкция VOLUME
Инструкция VOLUME позволяет указать местоположение, которое контейнер будет использовать для постоянного хранения файлов и для взаимодействия с такими файлами. Например, если ваше приложение записывает данные в файл во время выполнения, и вы хотите сохранить эти данные даже после удаления контейнера, инструкция VOLUME крайне полезна.

## Docker Compose <a name="docker-composee"></a> 

Docker Compose — это инструмент, входящий в состав Docker, предназначенный для упрощения задач, связанных с развёртыванием проектов. Его главное преимущество заключается в том, что он позволяет запускать несколько сервисов и контейнеров одновременно с помощью единой команды.

Docker Compose особенно полезен в ситуациях, когда ваш проект состоит из нескольких сервисов, которые должны взаимодействовать друг с другом. Например, если вы создаете веб-приложение (web API) и хотите подключить его к базе данных, Docker Compose может значительно упростить управление этими сервисами.

Основной задачей Docker Compose является описание инфраструктуры вашего проекта в файле docker-compose.yml. Этот файл содержит инструкции по запуску и конфигурации каждого сервиса, включая контейнеры, их сборку, настройку портов, зависимости и переменные окружения.

Пример файла docker-compose.yml приведен ниже:

```yaml
version: "3.8"

services:
  server:
    # Сервис 'server' для серверного приложения.
    build:
      context: .
      dockerfile: ./Dockerfile
    ports:
      - "1234:5000"
    depends_on:
      - server-db

  server-db:
    # Сервис 'server-db' для базы данных PostgreSQL.
    image: postgres:latest
    ports:
      - "5426:5432"
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: stockApiPassword
      POSTGRES_DB: server_db
```
В этом файле docker-compose.yml определены два сервиса: 'server' и 'server-db'. Настройки каждого сервиса включают:

* build (для 'server'): Инструкция для построения образа из Dockerfile в текущем контексте сборки.
* image (для 'server-db'): Использование готового образа PostgreSQL из Docker Hub.
* ports: Определение перенаправления портов для доступа к сервисам.
* depends_on: Зависимость 'server' от 'server-db', гарантируя, что 'server' будет запущен после 'server-db'.
* environment: Установка переменных окружения для настройки сервиса, включая имя пользователя, пароль и название базы данных для 'server-db'.
Этот файл docker-compose.yml позволяет легко запустить оба сервиса одновременно с помощью команды docker-compose up.

## Сборка и запуск проекта с помощью docker-compose <a name="build-n-run"></a> 
После того как в docker-compose.yml внесены все необходимые инструкции, проект нужно собрать.
```bash
docker-compose build
```
#### Запуск проекта:
Теперь, когда проект собран, пришло время его запустить.
```bash
docker-compose up
```

Давайте рассмотрим несколько полезных команд для управления Docker Compose:

#### Остановка и удаление контейнеров и ресурсов, созданных с помощью `docker-compose up`:

```bash
docker-compose down
```

Эта команда позволяет завершить выполнение контейнеров и освободить связанные с ними ресурсы.

#### Просмотр журналов сервисов:

```bash
docker-compose logs -f [название сервиса]
```

Вы можете использовать эту команду для просмотра журналов вывода отдельных сервисов. Например, в нашем проекте она может выглядеть так: `docker-compose logs -f server`.

#### Список запущенных контейнеров:

```bash
docker-compose ps
```
Эта команда выводит список всех контейнеров, запущенных с использованием Docker Compose.

#### Выполнение команды внутри контейнера:

```bash
docker-compose exec [название сервиса] [команда]
```
С помощью этой команды вы можете выполнить команду внутри запущенного контейнера. Например, для выполнения команды ls внутри контейнера 'server', команда будет выглядеть так: `docker-compose exec server ls`.

#### Список доступных образов:

```bash
docker-compose images
```
Эта команда выводит список образов, которые используются в вашем проекте Docker Compose.
